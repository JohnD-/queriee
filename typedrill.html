<!Doctype html>
<html>
<head><meta charset="utf-8"><link href='typedrill.css' rel='stylesheet'></link></head>
<body>
<script>
document.documentElement.focus()
let kk= new Map(), k0= new Map()
let w1= new Set(['Insert','Home','PageUp','Delete','End','PageDown','ArrowUp','ArrowLeft','ArrowDown','ArrowRight'])
let w2= new Set(['NumLock','NumpadDivide','NumpadMultiply','NumpadSubtract','Numpad7','Numpad8','Numpad9','NumpadAdd',
  'Numpad4','Numpad5','Numpad6','Numpad1','Numpad2','Numpad3','NumpadEnter','Numpad0','NumpadDecimal'])
let aa= []
let k1= new Map([['ArrowLeft','\u25C2'],['ArrowRight','\u25B8'],['ArrowUp','\u25B4'],['ArrowDown','\u25BE'],
  ['PageUp','Page\nUp'],['PageDown','Page\nDown'],['Tab'],['CapsLock','Caps\nLock'],['Enter'],['ShiftLeft','Shift'],
  ['ShiftRight','Shift'],['ControlLeft','Ctrl'],['ControlRight','Ctrl'],['AltLeft','Alt'],['AltRight','Alt'],
  ['MetaRight','Mode\nChange'],['MetaLeft','Meta'],
  ['Space'],['Insert'],['Delete'],['Home'],['End'],['Backspace'],['NumLock', 'Num\nLock'],['ContextMenu','𝄙'],['MetaRight','\u229E'],
  ['MetaLeft','OS'],['NumpadEnter','Enter']])
let k7= new Map(), r= ['KeyA','KeyS','KeyD','KeyF','KeyJ','KeyK','KeyL','Semicolon','Space']
let f= (k)=>{let f0, f1, f2, f3, f4, f, g, a, s0, s1, s2, c, cc, sh, sh1, d, index= 0
  f= _=> {s0= new Set(); s1= new Set(); s2= new Set()
    a= typeof k== 'string'? [...k].map(i=> ({code: k0.get(i)|| kk.get(i), shiftKey: kk.has(i)})): k; 
    if(false) {a= a.map(i=> i.code); a.forEach(c=> {g(k7.get(c).h, 'b4a'); g(c, 'b'/*, 'b1'*/)})
      f1= _=> {(a.includes(c)? s1: s2)[d? 'add': 'delete'](c)
        if(s1.size==a.length && s2.size==0){if(a.length){s2= new Set([...s1, ...s2]); s1.clear(); a= []}
        else {f3(); f5()} }}}
    else {f1= _=> {if(d && s2.has(c)) return; s2[d? 'add': 'delete'](c); f2()}; f2= _=> {if(d&& cc== c&& !!sh1== sh){f3(); f4()}}; f4()}}
  f0= e=> {if(e.repeat) return; c= e.code; d= e.type== 'keydown'; sh= e.shiftKey; f1()}
  f3= _=> {s0.forEach((i,j)=> j.classList.remove('b4a', 'b', 'bb', 'b1', 'b2', 'c0', 'c1')); s0.clear()}
  f4= _=> {a.slice(0,5).forEach(i=> g(i.code, 'c1')); const e= a.shift(); if(e){if(cc== (cc= e.code)) g(cc, 'bb'); const t= k7.get(cc).s;
      g(k7.get(cc).h, 'b4a'); g(cc, 'b'/*, 'c0'*/)
      if(sh1= e.shiftKey){g(t? 'ShiftLeft': 'ShiftRight', 'b'/*,'c0'*/); g(t? 'h1': 'h10', 'b4a')}}
    else f2= _=> s2.size|| f5()}
  f5= _=> {/*if(++index< b.length) f()*/k= [{code: aa[Math.floor(Math.random()* 4)][Math.floor(Math.random()* 11)+ 1], shiftKey: false}]
    if(['ShiftLeft', 'ShiftRight'].includes(k[0].code)) k[0].shiftKey= true; f()}
  g= (i, ...b)=> {let e= document.getElementById(i); e.classList.add(...b); s0.add(e)}
  addEventListener('keydown', f0); addEventListener('keyup', f0); f()
}
addEventListener('keydown', e=>{let c= e.code, x= e.key, y= 1- +e.shiftKey
  let d = document.getElementById(c); if(!d) return; d.classList.add('p')
  if(k1.has(c)){y= 0; x= k1.get(c)|| c}
  if(e.location== 3){y= 0; if(e.shiftKey) return; if(!e.getModifierState('NumLock')&& k0.has(c)) y= 1, x= k0.get(c)}
  d.children[y].textContent= x;  e.preventDefault()
  if(['NumLock', 'CapsLock'].includes(e.key)) {document.getElementById(e.key).style.opacity= e.getModifierState(e.key)? .25: ''}})
addEventListener('keyup', e=>{let d = document.getElementById(e.code); if(!d) return; d.classList.remove('p')})
new Map([['`', 'Backquote'], ['1', 'Digit1'], ['2', 'Digit2'], ['3', 'Digit3'], ['4', 'Digit4'], ['5', 'Digit5'], ['6', 'Digit6'],
  ['7', 'Digit7'], ['8', 'Digit8'], ['9', 'Digit9'], ['0', 'Digit0'], ['-', 'Minus'], ['=', 'Equal'], ['\b', 'Backspace'],
  ['\t', 'Tab'], ['q', 'KeyQ'], ['w', 'KeyW'], ['e', 'KeyE'], ['r', 'KeyR'], ['t', 'KeyT'], ['y', 'KeyY'], ['u', 'KeyU'],
  ['i', 'KeyI'], ['o', 'KeyO'], ['p', 'KeyP'], ['[', 'BracketLeft'], [']', 'BracketRight'], ['\\', 'Backslash'],
  ['\x01', 'CapsLock'], ['a', 'KeyA'], ['s', 'KeyS'], ['d', 'KeyD'], ['f', 'KeyF'], ['g', 'KeyG'], ['h', 'KeyH'],
  ['j', 'KeyJ'], ['k', 'KeyK'], ['l', 'KeyL'], [';', 'Semicolon'], ['\'', 'Quote'], ['\n', 'Enter'],
  ['\x0E', 'ShiftLeft'], ['\x00', 'IntlBackslash'], ['z', 'KeyZ'], ['x', 'KeyX'], ['c', 'KeyC'], ['v', 'KeyV'], ['b', 'KeyB'],
  ['n', 'KeyN'], ['m', 'KeyM'], [',', 'Comma'], ['.', 'Period'], ['/', 'Slash'], ['\x0F', 'ShiftRight'],
  ['\x06', 'ControlLeft'], ['\x02', 'MetaLeft'], ['\x04', 'AltLeft'], [' ', 'Space'],
  ['\x05', 'AltRight'], ['\x03', 'MetaRight'], ['\x0C', 'ContextMenu'], ['\x07', 'ControlRight']
]).forEach((i,j)=> k0.set(j,i))
k0.forEach((i, j)=> {let x= j.toUpperCase(); if(x!= j) kk.set(x, i)})
setTimeout(_=> {f10(); f('Hello World')}, 500)

function f10(){let k= Array.from(k0.values()); ['Backquote','Tab','CapsLock','IntlBackslash'].forEach(i=>
  aa.push(k.slice(i= k.indexOf(i), i+ 14))); k7.set('Space', {h: 'h0', s: false})
  aa.forEach(i=> i.forEach((i,j)=> {let s= j> 5; let j1= 6* +s+ 1; k7.set(i, {h: 'h'+ Math.min(Math.max(j, j1), j1+3), s: s})}))
  k7.get('ShiftRight').s= false
  let d= document.body.appendChild(document.createElement('div')); d.className= 'c'
  ;[[...k0.values()], w1, w2].forEach((i,j)=> {let d1= d.appendChild(document.createElement('div')); d1.className= 'w'+ j
     i.forEach(i=> {let d= d1.appendChild(document.createElement('div')); d.id= i
      ;[0,1].forEach(_=> d.appendChild(document.createElement('div')) ) }) })
  r.forEach((i, j)=>{let d= document.getElementById(i).appendChild(document.createElement('div')).appendChild(document.createElement('div'))
    d.textContent= ['Ⅴ','Ⅳ','Ⅲ','Ⅱ','Ⅱ','Ⅲ','Ⅳ','Ⅴ','Ⅰ'][j]; d.id= 'h'+ [1,2,3,4,7,8,9,10,0][j]})
  r.slice(0,8).forEach(i=> document.getElementById(i).classList.add('c3'))
  ;['Backspace', 'Tab', 'Backslash', 'CapsLock', 'Enter', 'ShiftLeft', 'ShiftRight', 'ControlLeft', 'MetaLeft',
  'AltLeft', 'Space', 'AltRight', 'MetaRight', 'ContextMenu', 'ControlRight'].forEach((i,j)=> {
    document.getElementById(i).style.gridColumnStart= 'span '+ [8,6,6,7,9,9,11,6,5,5,24,5,5,5,5][j]})
  ;['ArrowUp', 'ArrowLeft', 'ArrowDown', 'ArrowRight', 'NumpadAdd', 'NumpadEnter', 'Numpad0'].forEach((i,j)=> {
    document.getElementById(i).style.gridRowStart= [4, 5, 5, 5, 'span 2', 'span 2', 'auto'][j]
    document.getElementById(i).style.gridColumnStart= [2, 1, 2, 3, 'auto', 'auto', 'span 2'][j]})
  document.getElementById('IntlBackslash').style.display= 'none'
  k1.forEach((i,j)=> (!i|| i.length> 2) && (document.getElementById(j).classList.add('f')))
  new Map([['Numpad0', 'Ins'], ['Numpad1', 'End'], ['Numpad2', '▾'], ['Numpad3', 'Pg Dn'], ['Numpad4', '◂'], ['Numpad5', '']
          , ['Numpad6', '▸'], ['Numpad7', 'Home'], ['Numpad8', '▴'], ['Numpad9', 'Pg Up'], ['NumpadDecimal', 'Del']])
      .forEach((i,j)=> {k0.set(j,i); (!i|| i.length> 2) && (document.getElementById(j).children[1].classList.add('f1'))})
}
</script>
</body>
</html>
